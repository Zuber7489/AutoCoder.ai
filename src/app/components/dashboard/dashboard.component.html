<div class="dashboard-container">
  <!-- Sidebar -->
  <div class="sidebar" [class.sidebar-hidden]="!sidebarVisible">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
      <div class="logo-section">
        <div class="logo-icon">
          <i class="fas fa-robot"></i>
        </div>
        <h2>AutoCoder.ai</h2>
      </div>
      <button class="sidebar-toggle md:hidden" (click)="toggleSidebar()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Navigation Section -->
    <div class="nav-section">
      <button class="nav-btn primary" (click)="startNewChat()">
        <i class="fas fa-plus"></i>
        New chat
      </button>
      
      <div class="nav-search">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Search chats" class="search-input">
      </div>

      <!-- Removed extra nav links per request -->
    </div>



    <!-- Chat History Section -->
    <div class="chat-history">
      <div class="chat-history-header">
        <h3>Chats</h3>
      </div>


      
      <div class="chat-history-list">
        <!-- Current Chat Indicator -->
        <div *ngIf="chatHistories.length === 0" class="no-history">
          <span>No chat history yet</span>
        </div>
        
        <!-- Chat History Items -->
        <div
          *ngFor="let chat of chatHistories; trackBy: trackByChatId"
          class="chat-item"
          [class.active]="chat.id === currentChatId"
          (click)="switchToChat(chat.id)"
          title="{{ chat.title }}">

          <div class="chat-item-content">
            <div class="chat-title">{{ chat.title }}</div>
            <div class="chat-preview">{{ chat.lastMessage }}</div>
          </div>

          <button
            class="delete-chat-btn"
            (click)="deleteChat(chat.id, $event)"
            title="Delete Chat"
            *ngIf="chatHistories.length > 1">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- User Profile Section -->
    <div class="user-profile">
      <div class="profile-info">
        <div class="profile-avatar">
          <span>{{ (userDisplayName || 'U').charAt(0).toUpperCase() }}</span>
        </div>
        <div class="profile-details">
          <span class="profile-name">{{ userDisplayName || 'User' }}</span>
          <span class="profile-plan">Free</span>
        </div>
      </div>
    </div>



    <!-- API Configuration moved to Settings modal per request -->

    <!-- Chat Actions -->
    <div class="chat-actions">
      <button class="action-btn" (click)="clearChat()" [disabled]="isLoading">
        <i class="fas fa-trash"></i> Clear Chat
      </button>
      <!-- Export Chat button removed per user request -->
    </div>

    <!-- User Profile Section -->
    <div class="user-profile-section" (click)="openProfileModal()">
      <div class="profile-container">
        <div class="profile-avatar">
          <img 
            *ngIf="userProfilePic" 
            [src]="userProfilePic" 
            [alt]="userDisplayName || 'User'"
            class="profile-image"
            onerror="this.style.display='none'"
          />
          <div 
            *ngIf="!userProfilePic" 
            class="profile-fallback">
            <i class="fas fa-user"></i>
          </div>
        </div>
        <div class="profile-info">
          <div class="profile-name">{{ userDisplayName || 'User' }}</div>
          <div class="profile-email">{{ userEmail || 'Guest' }}</div>
        </div>
        <div class="profile-arrow">
          <i class="fas fa-chevron-right"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Chat Header -->
    <div class="chat-header">
      <div class="chat-header-left">
        <button class="sidebar-toggle-btn" (click)="toggleSidebar()">
          <i class="fas fa-bars"></i>
        </button>
        <h1 class="chat-title">{{ getCurrentChatTitle() }}</h1>
        <button class="dropdown-btn">
          <i class="fas fa-chevron-down"></i>
        </button>
      </div>
      <div class="chat-header-right">
        <button class="header-btn" (click)="shareChat()" title="Share Chat">
          <i class="fas fa-share"></i>
        </button>
        <button class="header-btn" (click)="openProfileModal()" title="More Options">
          <i class="fas fa-ellipsis-h"></i>
        </button>
      </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-container" #chatContainer>
      <!-- Scroll to Bottom Button -->
      <button 
        *ngIf="showScrollToBottom" 
        class="scroll-to-bottom-btn" 
        (click)="scrollToBottomManually()"
        title="Scroll to bottom">
        <i class="fas fa-chevron-down"></i>
      </button>
      <!-- Welcome Message -->
      <div *ngIf="conversation.length === 0" class="welcome-message">
        <div class="welcome-icon">
          <i class="fas fa-robot"></i>
        </div>
        <h2>Welcome to AutoCoder.ai</h2>
        <p>Your AI-powered coding assistant. Ask me anything about programming, and I'll help you with code, explanations, and solutions!</p>
        <div class="welcome-features">
          <div class="feature">
            <i class="fas fa-code"></i>
            <span>Code Generation</span>
          </div>
          <div class="feature">
            <i class="fas fa-bug"></i>
            <span>Bug Fixing</span>
          </div>
          <div class="feature">
            <i class="fas fa-lightbulb"></i>
            <span>Code Explanation</span>
          </div>
          <div class="feature">
            <i class="fas fa-search"></i>
            <span>Code Review</span>
          </div>
        </div>
      </div>

      <!-- Conversation Messages -->
      <div *ngFor="let message of conversation; trackBy: trackByMessage" 
           class="message"
           [class.user-message]="message.role === 'user'"
           [class.assistant-message]="message.role === 'assistant'"
           [class.system-message]="message.role === 'system'">
        
        <div class="message-avatar">
          <i *ngIf="message.role === 'user'" class="fas fa-user"></i>
          <i *ngIf="message.role === 'assistant'" class="fas fa-robot"></i>
          <i *ngIf="message.role === 'system'" class="fas fa-info-circle"></i>
        </div>

        <div class="message-content">
          <div class="message-text" [innerHTML]="message.content"></div>
          
          <!-- Display generated code if available -->
          <div *ngIf="message.code" class="generated-code">
            <div class="code-header">
              <span class="code-language">
                <i [class]="getLanguageIcon(message.language || selectedLanguage)"></i>
                {{ message.language || selectedLanguage }}
              </span>
              <button class="copy-code-btn" (click)="copyToClipboard(message.code)" title="Copy Code">
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <pre><code class="hljs" [innerHTML]="getHighlightedCode(message.code, message.language)"></code></pre>
          </div>
          
          <!-- Action Buttons for Assistant Messages -->
          <div *ngIf="message.role === 'assistant'" class="message-actions">
            <button class="action-btn-sm" (click)="copyToClipboard(message.code || message.content)" title="Like">
              <i class="fas fa-thumbs-up"></i>
            </button>
            <button class="action-btn-sm" (click)="copyToClipboard(message.code || message.content)" title="Dislike">
              <i class="fas fa-thumbs-down"></i>
            </button>
            <button class="action-btn-sm" (click)="startVoiceInput()" title="Read Aloud">
              <i class="fas fa-volume-up"></i>
            </button>
            <button class="action-btn-sm" (click)="showPreviewMethod(message.code)" title="Upload">
              <i class="fas fa-upload"></i>
            </button>
            <button class="action-btn-sm" (click)="regenerateResponse(message)" title="Regenerate">
              <i class="fas fa-redo"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Enhanced Loading Message -->
      <div *ngIf="isLoading" class="message assistant-message loading-message">
        <div class="message-avatar">
          <i class="fas fa-robot magic-pulse"></i>
        </div>
        <div class="message-content">
          <div class="message-header">
            <span class="message-role">AutoCoder.ai</span>
          </div>
          <div class="loading-animation">
            <div class="magic-text-lines">
              <div class="magic-line">ðŸ”® Analyzing your request...</div>
              <div class="magic-line">âœ¨ Conjuring the perfect code...</div>
              <div class="magic-line">ðŸª„ Weaving programming magic...</div>
              <div class="magic-line">âš¡ Almost ready to amaze you...</div>
            </div>
            <div class="typing-indicator">
              <span class="typing-dot"></span>
              <span class="typing-dot"></span>
              <span class="typing-dot"></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Input Area -->
    <div class="input-area">
      <div class="input-container">
        <div class="input-wrapper">
          <button class="voice-input-btn" (click)="startVoiceInput()" title="Voice Input">
            <i class="fas fa-microphone"></i>
          </button>
          <textarea
            [(ngModel)]="userInput"
            placeholder="Ask me anything about coding... (Type /shortcuts for help)"
            class="user-input"
            rows="1"
            (keydown)="onKeyDown($event)"
            (input)="autoResize($event)"
            #messageInput>
          </textarea>
          <button
            class="send-button"
            (click)="sendMessage()"
            [disabled]="!userInput.trim() || isLoading"
            [class.loading]="isLoading">
            <i *ngIf="!isLoading" class="fas fa-paper-plane"></i>
            <i *ngIf="isLoading" class="fas fa-spinner fa-spin"></i>
          </button>
        </div>
        <div class="input-footer">
          <span class="input-hint">
            AutoCoder.ai can make mistakes. Check important info.
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar Overlay for Mobile -->
  <div *ngIf="sidebarVisible" class="sidebar-overlay md:hidden" (click)="toggleSidebar()"></div>

  <!-- Success Celebration Overlay -->
  <div *ngIf="showConfetti" class="success-celebration">
    <div class="celebration-content">
      <div class="celebration-icon">ðŸŽ‰</div>
      <div class="celebration-title">Code Generated Successfully!</div>
      <div class="celebration-subtitle">Your amazing creation is ready to use</div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div *ngIf="showProfileModal" class="profile-modal-overlay" (click)="closeProfileModal()">
    <div class="profile-modal" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="modal-header">
        <h2>
          <i class="fas fa-cogs"></i>
          AutoCoder.ai Settings
        </h2>
        <button class="close-btn" (click)="closeProfileModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="modal-content">
        <!-- User Profile Section -->
        <div class="profile-section">
          <div class="profile-card">
            <div class="profile-avatar-large">
              <img 
                *ngIf="userProfilePic" 
                [src]="userProfilePic" 
                [alt]="userDisplayName || 'User'"
                class="avatar-image-large"
                onerror="this.style.display='none'"
              />
              <div 
                *ngIf="!userProfilePic" 
                class="avatar-fallback-large">
                <i class="fas fa-user"></i>
              </div>
            </div>
            
            <div class="profile-details">
              <h3>{{ userDisplayName || 'User' }}</h3>
              <p class="profile-email-text">{{ userEmail || 'Guest' }}</p>
              <p class="profile-id" *ngIf="userInfo?.uid">ID: {{ userInfo.uid | slice:0:8 }}...</p>
            </div>
          </div>
        </div>

        <!-- Language Settings -->
        <div class="settings-section">
          <h4>
            <i class="fas fa-code"></i>
            Programming Language
          </h4>
          <div class="language-selector-modal">
            <select [(ngModel)]="selectedLanguage" class="language-select-modal">
              <option *ngFor="let lang of languages" [value]="lang.value">
                {{ lang.label }}
              </option>
            </select>
            <div class="language-icon-modal">
              <i [class]="getCurrentLanguageIcon()"></i>
            </div>
          </div>
        </div>

        <!-- Quick Examples Section -->
        <div class="settings-section">
          <h4>
            <i class="fas fa-lightbulb"></i>
            Quick Examples
          </h4>

          <!-- Category Filter in Modal -->
          <div class="category-filter-modal">
            <button
              *ngFor="let category of categories"
              class="category-btn-modal"
              [class.active]="selectedCategory === category"
              (click)="selectCategory(category)">
              {{ category }}
            </button>
          </div>

          <div class="example-buttons-modal">
            <button
              *ngFor="let example of getFilteredExamples()"
              class="example-btn-modal feature-highlight"
              (click)="useQuickExample(example); closeProfileModal()"
              [disabled]="isLoading"
              [title]="example.prompt">
              <i [class]="example.icon"></i>
              {{ example.title }}
              <span class="category-badge-modal">{{ example.category }}</span>
            </button>
          </div>
        </div>

        <!-- Advanced Tools Section removed per request -->

        <!-- Quick Actions Section removed per request -->

        <!-- General Settings Section removed per request -->

        <!-- API Configuration (moved from sidebar) -->
        <div class="settings-section">
          <h4>
            <i class="fas fa-key"></i>
            API Configuration
          </h4>

          <div class="api-config">
            <div class="api-key-section">
            <label class="block text-sm font-medium mb-2">
              <i class="fas fa-robot"></i> Gemini API Key
            </label>
            <div class="api-key-input-group">
              <input
                type="password"
                [(ngModel)]="customApiKey"
                placeholder="Enter your Gemini API key..."
                class="api-key-input"
                [class.has-key]="hasCustomApiKey"
                (input)="onApiKeyChange()"
              />
              <button
                class="toggle-visibility-btn"
                (click)="toggleApiKeyVisibility()"
                [title]="showApiKey ? 'Hide API Key' : 'Show API Key'">
                <i [class]="showApiKey ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
              </button>
            </div>

            <div class="api-key-actions">
              <button
                class="save-key-btn"
                (click)="saveApiKey()"
                [disabled]="!customApiKey.trim()"
                title="Save API Key">
                <i class="fas fa-save"></i> Save Key
              </button>
              <button
                class="clear-key-btn"
                (click)="clearApiKey()"
                [disabled]="!hasCustomApiKey"
                title="Clear Saved Key">
                <i class="fas fa-trash"></i> Clear
              </button>
            </div>

            <div class="api-key-status">
              <div *ngIf="hasCustomApiKey" class="status-success">
                <i class="fas fa-check-circle"></i>
                <span>Using your custom API key</span>
              </div>
              <div *ngIf="!hasCustomApiKey" class="status-default">
                <i class="fas fa-info-circle"></i>
                <span>Using default API key</span>
              </div>
            </div>

            <div class="api-key-help">
              <p class="help-text">
                <i class="fas fa-lightbulb"></i>
                Get your free API key from 
                <a href="https://makersuite.google.com/app/apikey" target="_blank" rel="noopener">
                  Google AI Studio
                </a>
              </p>
            </div>
            </div>
          </div>
        </div>

        <!-- Actions Section -->
        <div class="actions-section">
          <button class="action-btn clear-data" (click)="clearAllData()">
            <i class="fas fa-trash-alt"></i>
            Clear All Data
          </button>
          
          <button 
            class="action-btn logout" 
            (click)="logout()" 
            [disabled]="isLoading">
            <i *ngIf="!isLoading" class="fas fa-sign-out-alt"></i>
            <i *ngIf="isLoading" class="fas fa-spinner fa-spin"></i>
            {{ isLoading ? 'Logging out...' : 'Logout' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>