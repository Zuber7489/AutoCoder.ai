<div class="dashboard-container">
  <!-- Sidebar -->
  <div class="sidebar" [class.sidebar-hidden]="!sidebarVisible">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
      <h2><i class="fas fa-robot text-blue-500"></i> AutoCoder.ai</h2>
      <button class="sidebar-toggle md:hidden" (click)="toggleSidebar()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Language Selector -->
    <div class="language-selector">
      <label class="block text-sm font-medium mb-2">
        <i class="fas fa-code"></i> Programming Language
      </label>
      <div class="relative">
        <select [(ngModel)]="selectedLanguage" class="language-select">
          <option *ngFor="let lang of languages" [value]="lang.value">
            {{ lang.label }}
          </option>
        </select>
        <div class="language-icon">
          <i [class]="getCurrentLanguageIcon()"></i>
        </div>
      </div>
    </div>

    <!-- Chat History Section -->
    <div class="chat-history">
      <div class="chat-history-header">
        <h3><i class="fas fa-history"></i> Chat History</h3>
        <button class="new-chat-btn" (click)="startNewChat()" title="Start New Chat">
          <i class="fas fa-plus"></i>
        </button>
      </div>
      
      <div class="chat-history-list">
        <!-- Current Chat Indicator -->
        <div *ngIf="chatHistories.length === 0" class="no-history">
          <i class="fas fa-comments"></i>
          <span>No chat history yet</span>
        </div>
        
        <!-- Chat History Items -->
        <div 
          *ngFor="let chat of chatHistories; trackBy: trackByChatId" 
          class="history-item"
          [class.active]="chat.id === currentChatId"
          (click)="switchToChat(chat.id)"
          title="{{ chat.title }}">
          
          <div class="history-item-content">
            <div class="history-item-header">
              <div class="history-language">
                <i [class]="getLanguageIcon(chat.language)"></i>
              </div>
              <div class="history-time">{{ getRelativeTime(chat.timestamp) }}</div>
              <button 
                class="delete-chat-btn" 
                (click)="deleteChat(chat.id, $event)"
                title="Delete Chat"
                *ngIf="chatHistories.length > 1">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            
            <div class="history-title">{{ chat.title }}</div>
            <div class="history-preview">{{ chat.lastMessage }}</div>
            
            <div class="history-stats">
              <span class="message-count">
                <i class="fas fa-comment"></i> {{ chat.messages.length }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Examples - Hidden per user request
    <div class="quick-examples">
      <h3><i class="fas fa-lightbulb"></i> Quick Examples</h3>
      <div class="example-buttons">
        <button
          *ngFor="let example of quickExamples"
          class="example-btn"
          (click)="useExample(example)"
          [disabled]="isLoading">
          <i [class]="example.icon"></i>
          {{ example.title }}
        </button>
      </div>
    </div>
    -->

    <!-- Chat Actions -->
    <div class="chat-actions">
      <button class="action-btn" (click)="clearChat()" [disabled]="isLoading">
        <i class="fas fa-trash"></i> Clear Chat
      </button>
      <!-- Export Chat button removed per user request -->
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Mobile Header -->
    <div class="mobile-header md:hidden">
      <button class="sidebar-toggle" (click)="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
      <h1><i class="fas fa-robot"></i> AutoCoder.ai</h1>
    </div>

    <!-- Chat Container -->
    <div class="chat-container" #chatContainer>
      <!-- Welcome Message -->
      <div *ngIf="conversation.length === 0" class="welcome-message">
        <div class="welcome-icon">
          <i class="fas fa-robot"></i>
        </div>
        <h2>Welcome to AutoCoder.ai</h2>
        <p>Your AI-powered coding assistant. Ask me anything about programming, and I'll help you with code, explanations, and solutions!</p>
        <div class="welcome-features">
          <div class="feature">
            <i class="fas fa-code"></i>
            <span>Code Generation</span>
          </div>
          <div class="feature">
            <i class="fas fa-bug"></i>
            <span>Bug Fixing</span>
          </div>
          <div class="feature">
            <i class="fas fa-lightbulb"></i>
            <span>Code Explanation</span>
          </div>
          <div class="feature">
            <i class="fas fa-search"></i>
            <span>Code Review</span>
          </div>
        </div>
      </div>

      <!-- Conversation Messages -->
      <div *ngFor="let message of conversation; trackBy: trackByMessage" 
           class="message"
           [class.user-message]="message.role === 'user'"
           [class.assistant-message]="message.role === 'assistant'"
           [class.system-message]="message.role === 'system'">
        
        <div class="message-avatar">
          <i *ngIf="message.role === 'user'" class="fas fa-user"></i>
          <i *ngIf="message.role === 'assistant'" class="fas fa-robot"></i>
          <i *ngIf="message.role === 'system'" class="fas fa-info-circle"></i>
        </div>

        <div class="message-content">
          <div class="message-header">
            <span class="message-role">
              {{ message.role === 'user' ? 'You' : message.role === 'assistant' ? 'AutoCoder.ai' : 'System' }}
            </span>
            <span class="message-time">{{ message.timestamp | date:'short' }}</span>
          </div>
          
          <div class="message-text" [innerHTML]="message.content"></div>
          
          <!-- Display generated code if available -->
          <div *ngIf="message.code" class="generated-code">
            <div class="code-header">
              <span class="code-language">
                <i [class]="getLanguageIcon(message.language || selectedLanguage)"></i>
                {{ message.language || selectedLanguage }}
              </span>
              <button class="copy-code-btn" (click)="copyToClipboard(message.code)" title="Copy Code">
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <pre><code class="hljs" [innerHTML]="message.code"></code></pre>
          </div>
          
          <!-- Action Buttons for Assistant Messages -->
          <div *ngIf="message.role === 'assistant'" class="message-actions">
            <button class="action-btn-sm" (click)="copyToClipboard(message.code || message.content)" title="Copy">
              <i class="fas fa-copy"></i>
            </button>
            <button *ngIf="message.code" 
                    class="action-btn-sm" 
                    (click)="showPreviewMethod(message.code)" 
                    title="Live Preview">
              <i class="fas fa-eye"></i>
            </button>
            <button class="action-btn-sm" (click)="regenerateResponse(message)" title="Regenerate">
              <i class="fas fa-redo"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Loading Message -->
      <div *ngIf="isLoading" class="message assistant-message loading-message">
        <div class="message-avatar">
          <i class="fas fa-robot"></i>
        </div>
        <div class="message-content">
          <div class="message-header">
            <span class="message-role">AutoCoder.ai</span>
          </div>
          <div class="loading-animation">
            <div class="typing-indicator">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <span class="loading-text">Thinking...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
      <div class="input-container">
        <div class="input-wrapper">
          <textarea
            [(ngModel)]="userInput"
            placeholder="Ask me anything about coding... (Shift + Enter for new line)"
            class="user-input"
            rows="1"
            (keydown)="onKeyDown($event)"
            (input)="autoResize($event)"
            #messageInput>
          </textarea>
          <button
            class="send-button"
            (click)="sendMessage()"
            [disabled]="!userInput.trim() || isLoading"
            [class.loading]="isLoading">
            <i *ngIf="!isLoading" class="fas fa-paper-plane"></i>
            <i *ngIf="isLoading" class="fas fa-spinner fa-spin"></i>
          </button>
        </div>
        <div class="input-footer">
          <span class="input-hint">
            <i class="fas fa-keyboard"></i>
            Press Enter to send, Shift + Enter for new line
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Live Preview Modal -->
  <div *ngIf="showPreviewModal" class="preview-modal" (click)="closePreview()">
    <div class="preview-content" (click)="$event.stopPropagation()">
      <div class="preview-header">
        <h3><i class="fas fa-eye"></i> Live Preview</h3>
        <button class="close-btn" (click)="closePreview()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="preview-body">
        <iframe #previewFrame [srcdoc]="previewContent" class="preview-frame"></iframe>
      </div>
    </div>
  </div>

  <!-- Sidebar Overlay for Mobile -->
  <div *ngIf="sidebarVisible" class="sidebar-overlay md:hidden" (click)="toggleSidebar()"></div>
</div>